<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {background-color: #f2f2f2;}
        a {
            text-decoration: none;
            color: #007bff;
        }
        a:hover {text-decoration: underline;}
        .btn {
            display: inline-block;
            padding: 8px 12px;
            margin-bottom: 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-links a {margin-left: 15px;}

        /* 페이지네이션 스타일 */
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination a, .pagination span {
            display: inline-block;
            padding: 8px 12px;
            margin: 0 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #007bff;
            text-decoration: none;
        }
        .pagination span {
            background-color: #f2f2f2;
            color: #555;
        }
        .pagination a.current {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <!-- 헤더: 제목 + 로그인/로그아웃 링크 -->
    <div class="header">
        <h2>게시글 목록</h2>
        <div class="header-links">
            <!--
                sec:authorize -> th:if 로 변경
                - session.loginMember가 없으면(null) 보임 (로그인 안 한 상태)
            -->
            <a href="/members/login" th:if="${loginMember == null}">로그인</a>
            <a href="/members/join" th:if="${loginMember == null}">회원가입</a>

            <!--
                - session.loginMember가 있으면(not null) 보임 (로그인 한 상태)
                - session.loginMember 객체의 'nickname' 필드 표시
            -->
            <span th:if="${loginMember != null}">
                <strong th:text="${loginMember.nickname}">사용자닉네임</strong>님 환영합니다!
            </span>
            <!-- 로그아웃 URL(/logout)은 LoginController에 만듦 -->
            <a href="/logout" th:if="${loginMember != null}">로그아웃</a>
        </div>
    </div>

    <!-- 새 글 작성하기 버튼 -->
    <!-- 로그인한 사용자에게만 '새 글 작성하기' 버튼이 보이도록 수정 -->
    <a href="/posts/add" class="btn" th:if="${loginMember != null}">새 글 작성하기</a>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
            </tr>
        </thead>
        <tbdoy>
            <!-- 게시글 목록 순회 (th:each) -->
            <tr th:each="post, loopStat : ${postPage.content}">
                <td th:text="${postPage.totalElements - (postPage.number * postPage.size) - loopStat.index}">1</td>
                <td>
                    <!-- 제목을 누르면 상세 페이지로 이동 -->
                    <a th:href="@{/posts/{id}(id=${post.id})}"
                       th:text="${post.title}">게시글 제목</a>
                </td>
                <td th:text="${post.authorNickname}">작성자</td>
                <!-- 날짜 포맷팅 (예: 2025-11-15 10:30) -->
                <td th:text="${#temporals.format(post.createdDate, 'yyyy-MM-dd HH:mm')}">2025-01-01</td>
            </tr>
            <!-- 게시글이 없을 경우 -->
            <tr th:if="${#lists.isEmpty(postPage.content)}">
                <td colspan="4">작성된 게시글이 없습니다.</td>
            </tr>
        </tbdoy>
    </table>

    <!-- 페이지네이션 버튼 (Page 객체 사용) -->
    <div class="pagination" th:if="${postPage.totalPages > 1}">
        <!-- '이전' 버튼: 현재 페이지가 첫 번째 페이지(number == 0)가 '아닐' 때만 보임 -->
        <a th:href="@{/posts(page=${postPage.number - 1})}"
           th:unless="${postPage.first}">
            이전
        </a>
        <span th:if="${postPage.first}">이전</span>

        <span th:each="pageNumber : ${#numbers.sequence(1, postPage.totalPages)}">
            <a th:href="@{/posts(page=${pageNumber - 1})}"
               th:text="${pageNumber}"
               th:classappend="${pageNumber == postPage.number + 1} ? 'current' : ''">
            </a>
        </span>

        <!-- '다음' 버튼: 현재 페이지가 마지막 페이지(number == totalPages - 1)가 '아닐' 때만 보임 -->
        <a th:href="@{/posts(page=${postPage.number + 1})}"
           th:unless="${postPage.last}">
            다음
        </a>
        <span th:if="${postPage.last}">다음</span>
    </div>
</body>
</html>